<html>
	<head>
        <meta name="author" lang="fr" content="seth37">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		<style>
			@font-face {
			font-family: 'xian';
			font-display: auto;
			src: url("QUIQRX+Xiinthlea-Regular.ttf") format('truetype'),
			url('quiqrxxiinthlea-regular-webfont.woff2') format('woff2'),
			url('quiqrxxiinthlea-regular-webfont.woff') format('woff');
			font-weight: normal;
			font-style: normal;
			}
			body
			{
				text-align: center;
			}
			textarea
			{
				width: 50%;
				height: 300px;
				font-size:18px
			}

			#xian
			{
				 font-family: 'xian';
			}
		</style>
    </head>
	<body>
	<div >
		<h2>SRX</h2>
		<textarea id="srx" spellcheck="false" ></textarea>
	</div>
	<div>
		<h2>Xi'an</h2>
		<textarea id="xian" spellcheck="false"></textarea>
	</div>
	<script>
	String.prototype.replaceAt=function(index, replacement) {
    return this.substr(0, index) + replacement+ this.substr(index + replacement.length);
	}
	
	$("#srx").on("change paste keyup",function(){
	var text = $("#srx").val();
	$("#xian").val("");
	text = text.replace(/aa/g, "ā");
	text = text.replace(/AA/g, "Ā");
	text = text.replace(/āa/g, "â");
	text = text.replace(/oo/g, "ō");
	text = text.replace(/OO/g, "Ō");
	text = text.replace(/uu/g, "ū");
	text = text.replace(/UU/g, "Ū");
	text = text.replace(/ee/g, "ē");
	text = text.replace(/EE/g, "Ē");
	text = text.replace(/EE/g, "Ē");
	text = text.replace(/\'/g, "’");
	text = text.replace(/\"/g, "”");
	$("#srx").val(text);
	var xian_0 = text;
	xian_0 = xian_0.replace(/\n/g, " \n ");
	var text_array = xian_0.split(" ");
	var xian = "";
	var texte_type = "";

	text_array.forEach(function(word_xian) {	
	
	word_xian = word_xian.replace(/A/g, "@a");
	word_xian = word_xian.replace(/Ā/g, "@ā");
	word_xian = word_xian.replace(/O/g, "@o");
	word_xian = word_xian.replace(/Ō/g, "@ō");
	word_xian = word_xian.replace(/U/g, "@u");
	word_xian = word_xian.replace(/Ū/g, "@ū");
	word_xian = word_xian.replace(/E/g, "@e");
	word_xian = word_xian.replace(/Ē/g, "@ē");
	word_xian = word_xian.replace(/I/g, "@i");
	word_xian = word_xian.replace(/Y/g, "@y");
	word_xian = word_xian.replace(/P/g, "@p");
	word_xian = word_xian.replace(/K/g, "@k");
	word_xian = word_xian.replace(/T/g, "@t");
	word_xian = word_xian.replace(/S/g, "@s");
	word_xian = word_xian.replace(/H/g, "@h");
	word_xian = word_xian.replace(/M/g, "@m");
	word_xian = word_xian.replace(/N/g, "@n");
	word_xian = word_xian.replace(/L/g, "@l");
	word_xian = word_xian.replace(/R/g, "@r");
	word_xian = word_xian.replace(/X/g, "@x");
	word_xian = word_xian.replace(/C/g, "@c");
	
	clear_xian = word_xian.replace(/[.’”]/gi, '');
	
	word_xian = e1(word_xian);
	clear_xian = e1(clear_xian);
	
	word_xian_low = word_xian.replace(/[@]/gi, '');
	l = clear_xian.length;
	
	if( l == 1 || ( l == 2 && clear_xian[0] == "@") ){
		clear_xian = e2(clear_xian,l);
	}
	else{
		var cvn = clear_xian;
		
		cvn = cvn.replace(/ùĕ/g, "??");
		cvn = cvn.replace(/jĕ/g, "??");
		
		cvn = cvn.replace(/[ÏẅẄøØÿuYĨzZcCỹỸIwWőŐyYěäÄöÖvUëËïãÃõÕũŨẽẼĩAOUEaouei]/g, "v");
		cvn = cvn.replace(/[ŗļçXþgðpktshmnj]/g, "c");
		cvn = cvn.replace(/[?&ė@]/g, "n");
		
		for ( i = l-1; i>0 ; i--) {	
			if(cvn[i] == "c"){
				if(/^([kmngþlr])$/.test(clear_xian[i]) && i>1 && cvn[i-1]=="v" && cvn[i-2]!="v"){
					clear_xian = e3(clear_xian,i);
				}
			}
		}
		//alert(cvn);
		if(cvn[l-1]=="v"){
			if(clear_xian.match(/[KMNGÞR]/g)!= null){
				count = l - clear_xian.match(/[@KMNGÞR]/g).length ;
				if(clear_xian.match(/[&ė1234567890]/g)!= null){
				count= count + clear_xian.match(/[&ė1234567890]/g).length
				}
				
				if(count%2==1){
					clear_xian = e2(clear_xian,l);
				}
			}
		}
	}
	//if(clear_xian.length!=word_xian.length){
	//	for ( i = l-1; i>0 ; i--) {			
	//	}
	//}
		
	xian = xian + clear_xian;

	});

	$("#xian").val(xian);

	});
	
	function e1 ( text ){
		text = text.replace(/â/g, "%");	
	text = text.replace(/uii/g, "Ï");
	text = text.replace(/uao/g, "ẅ");
	text = text.replace(/uāo/g, "Ẅ");
	text = text.replace(/uoa/g, "ø");
	text = text.replace(/uōa/g, "Ø");
	text = text.replace(/uai/g, "ÿ");
	text = text.replace(/uāi /g, "Ÿ");
	text = text.replace(/uea/g, "ùĕ");
	text = text.replace(/uth/g, "&");
	text = text.replace(/e’e/g, "ė’ ");
	text = text.replace(/yii/g, "Ĩ");
	text = text.replace(/yao/g, "z");
	text = text.replace(/yāo/g, "Z");
		text = text.replace(/yoa/g, "b");
	text = text.replace(/yōa/g, "C");
	text = text.replace(/yai/g, "ỹ");
	text = text.replace(/yāi/g, "Ỹ");
	text = text.replace(/yea/g, "jĕ");
	text = text.replace(/thl/g, "ð");
	
	text = text.replace(/xy/g, "X");
	text = text.replace(/ii/g, "I");	
	text = text.replace(/ao/g, "w");
	text = text.replace(/āo/g, "W");
	text = text.replace(/oa/g, "ő");
	text = text.replace(/ōa/g, "Ő");
		text = text.replace(/ai/g, "f");
	text = text.replace(/āi/g, "Y");
	text = text.replace(/ae/g, "ě");
	text = text.replace(/ua/g, "ä");
	text = text.replace(/uā/g, "Ä");
	text = text.replace(/uo/g, "ö");
	text = text.replace(/uō/g, "Ö");
	text = text.replace(/vu/g, "v");
	text = text.replace(/ue/g, "ë");
	text = text.replace(/uē/g, "Ë");
	text = text.replace(/ui/g, "ï");
	text = text.replace(/ya/g, "ã");
	text = text.replace(/yā/g, "Ã");
	text = text.replace(/yo/g, "õ");
	text = text.replace(/yō/g, "Õ");
	text = text.replace(/yu/g, "ũ");
	text = text.replace(/yū/g, "Ũ")
	text = text.replace(/ye/g, "ẽ");
	text = text.replace(/yē/g, "Ẽ");
	text = text.replace(/yi/g, "ĩ");
	text = text.replace(/ng/g, "g");
	text = text.replace(/th/g, "þ");
	text = text.replace(/ch/g, "ç");
		text = text.replace(/b/g, "c");
	text = text.replace(/kl/g, "ļ");
	text = text.replace(/kr/g, "ŗ");
	
	text = text.replace(/ā/g, "A");
	text = text.replace(/ō/g, "O");
	text = text.replace(/ū/g, "U");
	text = text.replace(/ē/g, "E");
	text = text.replace(/y/g, "j");
		text = text.replace(/f/g, "y");
	return text;
	}
		
	function e2(text,l){
				if ( text[l-1] == "a" ){
					text = text.replaceAt(l-1,"á");
				}
				else if ( text[l-1] == "A" ){
					text = text.replaceAt(l-1,"Á");
				}
				else if ( text[l-1] == "o" ){
					text = text.replaceAt(l-1,"ó");
				}
				else if ( text[l-1] == "O" ){
					text = text.replaceAt(l-1,"Ó");
				}
				else if ( text[l-1] == "u" ){
					text = text.replaceAt(l-1,"ú");
				}
				else if ( text[l-1] == "U" ){
					text = text.replaceAt(l-1,"Ú");
				}
				else if ( text[l-1] == "e" ){
					text = text.replaceAt(l-1,"é");
				}
				else if ( text[l-1] == "E" ){
					text = text.replaceAt(l-1,"É");
				}
				else if ( text[l-1] == "i" ){
					text = text.replaceAt(l-1,"í");
				}
				else if ( text[l-1] == "I" ){
					text = text.replaceAt(l-1,"Í");
				}
				else if ( text[l-1] == "w" ){
					text = text.replaceAt(l-1,"ẃ");
				}
				else if ( text[l-1] == "W" ){
					text = text.replaceAt(l-1,"Ẃ");
				}
				else if ( text[l-1] == "ő" ){
					text = text.replaceAt(l-1,"ȯ");
				}
				else if ( text[l-1] == "Ő" ){
					text = text.replaceAt(l-1,"Ȯ");
				}
				else if ( text[l-1] == "y" ){
					text = text.replaceAt(l-1,"ý");
				}
				else if ( text[l-1] == "Y" ){
					text = text.replaceAt(l-1,"Ý");
				}
				else if ( text[l-1] == "ě" ){
					text = text.replaceAt(l-1,"Ě");
				}
				else if ( text[l-1] == "ä" ){
					text = text.replaceAt(l-1,"â");
				}
				else if ( text[l-1] == "Ä" ){
					text = text.replaceAt(l-1,"Ä");
				}
				else if ( text[l-1] == "ö" ){
					text = text.replaceAt(l-1,"ô");
				}
				else if ( text[l-1] == "Ö" ){
					text = text.replaceAt(l-1,"Ô");
				}
				else if ( text[l-1] == "v" ){
					text = text.replaceAt(l-1,"V");
				}
				else if ( text[l-1] == "ë" ){
					text = text.replaceAt(l-1,"ê");
				}
				else if ( text[l-1] == "Ë" ){
					text = text.replaceAt(l-1,"Ê");
				}
				else if ( text[l-1] == "ï" ){
					text = text.replaceAt(l-1,"î");
				}
				else if ( text[l-1] == "Ï" ){
					text = text.replaceAt(l-1,"Î");
				}
				else if ( text[l-1] == "ẅ" ){
					text = text.replaceAt(l-1,"ŵ");
				}
				else if ( text[l-1] == "Ẅ" ){
					text = text.replaceAt(l-1,"Ŵ");
				}
				else if ( text[l-1] == "ø" ){
					text = text.replaceAt(l-1,"œ");
				}
				else if ( text[l-1] == "Ø" ){
					text = text.replaceAt(l-1,"Œ");
				}
				else if ( text[l-1] == "ÿ" ){
					text = text.replaceAt(l-1,"ŷ");
				}
				else if ( text[l-1] == "Ÿ" ){
					text = text.replaceAt(l-1,"Ŷ");
				}
				else if ( text[l-1] == "ã" ){
					text = text.replaceAt(l-1,"ā");
				}
				else if ( text[l-1] == "Ã" ){
					text = text.replaceAt(l-1,"Ā");
				}
				else if ( text[l-1] == "õ" ){
					text = text.replaceAt(l-1,"ō");
				}
				else if ( text[l-1] == "Õ" ){
					text = text.replaceAt(l-1,"Ō");
				}
				else if ( text[l-1] == "ũ" ){
					text = text.replaceAt(l-1,"ū");
				}
				else if ( text[l-1] == "Ũ" ){
					text = text.replaceAt(l-1,"Ū");
				}
				else if ( text[l-1] == "ẽ" ){
					text = text.replaceAt(l-1,"ē");
				}
				else if ( text[l-1] == "Ẽ" ){
					text = text.replaceAt(l-1,"Ē");
				}
				else if ( text[l-1] == "ĩ" ){
					text = text.replaceAt(l-1,"ī");
				}
				else if ( text[l-1] == "Ĩ" ){
					text = text.replaceAt(l-1,"Ī");
				}
				else if ( text[l-1] == "z" ){
					text = text.replaceAt(l-1,"ź");
				}
				else if ( text[l-1] == "Z" ){
					text = text.replaceAt(l-1,"Ź");
				}
				else if ( text[l-1] == "c" ){
					text = text.replaceAt(l-1,"b");
				}
				else if ( text[l-1] == "C" ){
					text = text.replaceAt(l-1,"B");
				}
				else if ( text[l-1] == "ỹ" ){
					text = text.replaceAt(l-1,"ȳ");
				}
				else if ( text[l-1] == "Ỹ" ){
					text = text.replaceAt(l-1,"Ȳ");
				}
				else{}
	return text;
	}
	function e3 (text,i){
				if ( text[i] == "k" ){
					text = text.replaceAt(i,"K");
				}
				else if ( text[i] == "m" ){
					text = text.replaceAt(i,"M");
				}
				else if ( text[i] == "n" ){
					text = text.replaceAt(i,"N");
				}
				else if ( text[i] == "g" ){
					text = text.replaceAt(i,"G");
				}
				else if ( text[i] == "þ" ){
					text = text.replaceAt(i,"Þ");
				}
				else if ( text[i] == "l" || text[i] == "r"){
					text = text.replaceAt(i,"R");
				}
				else {}
				
				if ( text[i-1] == "a" ){
					text = text.replaceAt(i-1,"à");
				}
				else if ( text[i-1] == "A" ){
					text = text.replaceAt(i-1,"À");
				}
				else if ( text[i-1] == "o" ){
					text = text.replaceAt(i-1,"ò");
				}
				else if ( text[i-1] == "O" ){
					text = text.replaceAt(i-1,"Ò");
				}
				else if ( text[i-1] == "u" ){
					text = text.replaceAt(i-1,"ù");
				}
				else if ( text[i-1] == "U" ){
					text = text.replaceAt(i-1,"Ù");
				}
				else if ( text[i-1] == "e" ){
					text = text.replaceAt(i-1,"è");
				}
				else if ( text[i-1] == "E" ){
					text = text.replaceAt(i-1,"È");
				}
				else if ( text[i-1] == "i" ){
					text = text.replaceAt(i-1,"ì");
				}
				else if ( text[i-1] == "I" ){
					text = text.replaceAt(i-1,"Ì");
				}
				else if ( text[i-1] == "w" ){
					text = text.replaceAt(i-1,"ẁ");
				}
				else if ( text[i-1] == "W" ){
					text = text.replaceAt(i-1,"Ẁ");
				}
				else if ( text[i-1] == "ő" ){
					text = text.replaceAt(i-1,"ŏ");
				}
				else if ( text[i-1] == "Ő" ){
					text = text.replaceAt(i-1,"Ŏ");
				}
				else if ( text[i-1] == "y" ){
					text = text.replaceAt(i-1,"ỳ");
				}
				else if ( text[i-1] == "Y" ){
					text = text.replaceAt(i-1,"Ỳ");
				}
				else if ( text[i-1] == "ě" ){
					text = text.replaceAt(i-1,"Ĕ");
				}
				else if ( text[i-1] == "ä" ){
					text = text.replaceAt(i-1,"ạ");
				}
				else if ( text[i-1] == "Ä" ){
					text = text.replaceAt(i-1,"Ạ");
				}
				else if ( text[i-1] == "ö" ){
					text = text.replaceAt(i-1,"ọ");
				}
				else if ( text[i-1] == "Ö" ){
					text = text.replaceAt(i-1,"Ọ");
				}
				else if ( text[i-1] == "ë" ){
					text = text.replaceAt(i-1,"ẹ");
				}
				else if ( text[i-1] == "Ë" ){
					text = text.replaceAt(i-1,"Ẹ");
				}
				else if ( text[i-1] == "ï" ){
					text = text.replaceAt(i-1,"ị");
				}
				else if ( text[i-1] == "Ï" ){
					text = text.replaceAt(i-1,"Ị");
				}
				else if ( text[i-1] == "ẅ" ){
					text = text.replaceAt(i-1,"ẉ");
				}
				else if ( text[i-1] == "Ẅ" ){
					text = text.replaceAt(i-1,"Ẉ");
				}
				else if ( text[i-1] == "ø" ){
					text = text.replaceAt(i-1,"æ");
				}
				else if ( text[i-1] == "Ø" ){
					text = text.replaceAt(i-1,"Æ");
				}
				else if ( text[i-1] == "ÿ" ){
					text = text.replaceAt(i-1,"ỵ");
				}
				else if ( text[i-1] == "Ÿ" ){
					text = text.replaceAt(i-1,"Ỵ");
				}
				else if ( text[i-1] == "ã" ){
					text = text.replaceAt(i-1,"ả");
				}
				else if ( text[i-1] == "Ã" ){
					text = text.replaceAt(i-1,"À");
				}
				else if ( text[i-1] == "õ" ){
					text = text.replaceAt(i-1,"ỏ");
				}
				else if ( text[i-1] == "Õ" ){
					text = text.replaceAt(i-1,"Ỏ");
				}
				else if ( text[i-1] == "ũ" ){
					text = text.replaceAt(i-1,"ủ");
				}
				else if ( text[i-1] == "Ũ" ){
					text = text.replaceAt(i-1,"Ủ");
				}
				else if ( text[i-1] == "ẽ" ){
					text = text.replaceAt(i-1,"ẻ");
				}
				else if ( text[i-1] == "Ẽ" ){
					text = text.replaceAt(i-1,"Ẻ");
				}
				else if ( text[i-1] == "ĩ" ){
					text = text.replaceAt(i-1,"ỉ");
				}
				else if ( text[i-1] == "Ĩ" ){
					text = text.replaceAt(i-1,"Ỉ");
				}
				else if ( text[i-1] == "z" ){
					text = text.replaceAt(i-1,"ż");
				}
				else if ( text[i-1] == "Z" ){
					text = text.replaceAt(i-1,"Ż");
				}
				else if ( text[i-1] == "c" ){
					text = text.replaceAt(i-1,"d");
				}
				else if ( text[i-1] == "C" ){
					text = text.replaceAt(i-1,"D");
				}
				else if ( text[i-1] == "ỹ" ){
					text = text.replaceAt(i-1,"ỷ");
				}
				else if ( text[i-1] == "Ỹ" ){
					text = text.replaceAt(i-1,"Ỷ");
				}
				else{}
				
	return text;
	}

	</script>
	</body>
<html>